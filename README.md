# TP-ANSIBLE

### MEMBRES DU GROUPE:

**Maxime SORIN**  
**Clément Fourrier**  
**Guillaume Charpentier**  
**Florian Bouillon**  
**Nicolas Brossard**  
**Théo Memin**  

Architecture:
```bash
drwxr-xr-x    - s0dyy s0dyy 2021-06-18 16:43 ./
drwxr-xr-x    - s0dyy s0dyy 2021-06-18 15:45 ├── files/
drwxr-xr-x    - s0dyy s0dyy 2021-05-03 09:04 │  ├── html/
drwxr-xr-x    - s0dyy s0dyy 2021-06-18 16:35 │  │  ├── assets/
.rw-r--r--    0 s0dyy s0dyy 2021-05-03 09:04 │  │  │  ├── .gitkeep
.rw-r--r--  146 s0dyy s0dyy 2021-06-18 16:35 │  │  │  └── config.json
.rw-r--r--  948 s0dyy s0dyy 2021-06-17 18:48 │  │  ├── favicon.ico
.rw-r--r--  826 s0dyy s0dyy 2021-06-17 20:52 │  │  ├── index.html
.rw-r--r--  20k s0dyy s0dyy 2021-06-17 20:49 │  │  ├── main-es5.js
.rw-r--r--  17k s0dyy s0dyy 2021-06-17 20:49 │  │  ├── main-es2015.js
.rw-r--r-- 662k s0dyy s0dyy 2021-06-17 19:36 │  │  ├── polyfills-es5.js
.rw-r--r-- 143k s0dyy s0dyy 2021-06-17 19:35 │  │  ├── polyfills-es2015.js
.rw-r--r-- 6.3k s0dyy s0dyy 2021-06-17 19:35 │  │  ├── runtime-es5.js
.rw-r--r-- 6.3k s0dyy s0dyy 2021-06-17 19:35 │  │  ├── runtime-es2015.js
.rw-r--r--  11k s0dyy s0dyy 2021-06-17 19:35 │  │  ├── styles-es5.js
.rw-r--r--  10k s0dyy s0dyy 2021-06-17 19:35 │  │  ├── styles-es2015.js
.rw-r--r-- 3.0M s0dyy s0dyy 2021-06-17 19:36 │  │  ├── vendor-es5.js
.rw-r--r-- 2.6M s0dyy s0dyy 2021-06-17 19:36 │  │  └── vendor-es2015.js
drwxr-xr-x    - s0dyy s0dyy 2021-06-18 15:27 │  └── nginx/
.rw-r--r--  521 s0dyy s0dyy 2021-06-18 15:27 │     └── default
drwxr-xr-x    - s0dyy s0dyy 2021-06-18 14:34 ├── inventory/
.rw-r--r--  119 s0dyy s0dyy 2021-06-18 14:34 │  └── hosts
drwxr-xr-x    - s0dyy s0dyy 2021-06-18 16:31 ├── playbook/
.rw-r--r--  513 s0dyy s0dyy 2021-06-18 16:24 │  ├── app.yml
.rw-r--r--  744 s0dyy s0dyy 2021-06-18 16:31 │  └── nginx.yml
drwxr-xr-x    - s0dyy s0dyy 2021-06-18 16:35 ├── template/
.rw-r--r--  215 s0dyy s0dyy 2021-06-18 16:35 │  └── config.json.j2
drwxr-xr-x    - s0dyy s0dyy 2021-06-18 16:35 ├── variables/
.rw-r--r--   80 s0dyy s0dyy 2021-06-18 16:35 │  └── vars.yml
.rw-r--r--   13 s0dyy s0dyy 2021-06-18 16:36 └── README.md
```

Install and configure nginx:
```bash
ansible-playbook -i inventory/hosts playbook/nginx.yml

PLAY [Configure webserver with nginx] ******************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [install nginx] ***********************************************************************************************************************************************************************************************************************************************************************
changed: [127.0.0.1]

TASK [copy nginx config] *******************************************************************************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [start nginx] *************************************************************************************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

PLAY RECAP *********************************************************************************************************************************************************************************************************************************************************************************
127.0.0.1                  : ok=4    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```

Deploy application:
```bash
ansible-playbook -i inventory/hosts playbook/app.yml

PLAY [Deploy application] ******************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************************************************************************
[WARNING]: Platform linux on host 127.0.0.1 is using the discovered Python interpreter at /usr/bin/python, but future installation of another Python interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible/2.10/reference_appendices/interpreter_discovery.html for more information.
ok: [127.0.0.1]

TASK [load variables] **********************************************************************************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [template the file] *******************************************************************************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [deploy] ******************************************************************************************************************************************************************************************************************************************************************************
changed: [127.0.0.1]

TASK [reload nginx] ************************************************************************************************************************************************************************************************************************************************************************
changed: [127.0.0.1]

PLAY RECAP *********************************************************************************************************************************************************************************************************************************************************************************
127.0.0.1                  : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```

Result:
```html
Bonjour Maxime Sorin de la promotion B3DEV
Merci de m'avoir deployé avec succès ❤

Ne dite rien mais mon secret est (show):
Mes hobbies sont :

    Series
    Movies
    Comics
```

Stop and remove nginx:
```bash
ansible-playbook -i inventory/hosts playbook/nginx.yml --tags stop,uninstall

PLAY [Configure webserver with nginx] ******************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [stop nginx] **************************************************************************************************************************************************************************************************************************************************************************
changed: [127.0.0.1]

TASK [remove nginx] ************************************************************************************************************************************************************************************************************************************************************************
changed: [127.0.0.1]

PLAY RECAP *********************************************************************************************************************************************************************************************************************************************************************************
127.0.0.1                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```
